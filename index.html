<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Amret D&I Pre-Test Insights</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <!-- Chosen Palette: Serene Harmony -->
    <!-- Application Structure Plan: A thematic, single-page dashboard designed for intuitive exploration. The structure starts with a high-level "Key Insights" dashboard to present the core narrative (the confidence-competence gap) immediately. Users can then navigate via a sticky top bar to deeper thematic sections: 1) "The Knowledge Gap" which contrasts theoretical vs. practical understanding, 2) "Perceptions" which visualizes the confidence mismatch and organizational buy-in, 3) a "Demographic Deep Dive" with interactive filters, and 4) "Strategic Recommendations" with an accordion for actionable steps. This non-linear, dashboard approach was chosen over a report-like structure to make the key findings more accessible and to allow stakeholders (like HR and leadership) to quickly grasp the main points and then explore areas of interest, which is more effective for strategic decision-making. -->
    <!-- Visualization & Content Choices:
        - Overall Score Distribution: Inform -> Bar Chart (Chart.js) -> Shows the spread of scores clearly.
        - Knowledge Gap Analysis: Compare -> Horizontal Bar Chart (Chart.js) -> Effectively compares performance across different knowledge domains, highlighting strengths and weaknesses. Interaction: Hover for details. Justification: Visually intuitive for comparing question success rates.
        - Confidence vs. Competence: Compare -> Donut Charts for confidence, side-by-side with stat cards for low competence scores (HTML/CSS) -> Juxtaposes the two conflicting data points directly to emphasize the core "gap" finding. Interaction: Static visual comparison. Justification: High-impact visualization for the report's central theme.
        - Importance of Gender Equality: Inform -> Donut Chart + Clickable Card (HTML/JS) -> Shows strong consensus and reveals qualitative reasons on demand. Interaction: Click to show themed quotes. Justification: Combines quantitative and qualitative data engagingly.
        - Demographic Analysis: Relationships -> Filterable Scatter Plot (Chart.js) -> Allows exploration of relationships between score, confidence, and demographics. Interaction: Dropdown and radio button filters update the chart. Justification: Provides a multi-dimensional, interactive view of the data without making definitive claims due to small sample sizes.
        - Recommendations: Organize -> Accordion (HTML/JS) -> Presents actionable steps in a clean, digestible format. Interaction: Click to expand/collapse. Justification: Organizes detailed text content without cluttering the UI.
    -->
    <!-- CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. -->
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #FDFBF7;
            color: #333333;
        }
        .chart-container {
            position: relative;
            width: 100%;
            margin-left: auto;
            margin-right: auto;
            max-width: 600px;
            height: 320px;
            max-height: 400px;
        }
        @media (min-width: 640px) {
            .chart-container {
                height: 350px;
            }
        }
        .nav-link {
            transition: color 0.3s, border-bottom-color 0.3s;
            border-bottom: 2px solid transparent;
        }
        .nav-link:hover, .nav-link.active {
            color: #4A908A;
            border-bottom-color: #4A908A;
        }
        .kpi-card {
            background-color: white;
            border-radius: 0.75rem;
            padding: 1.5rem;
            box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
            border: 1px solid #F0EBE3;
        }
    </style>
</head>
<body class="antialiased">

    <!-- Header & Navigation -->
    <header class="sticky top-0 bg-white/80 backdrop-blur-md z-50 shadow-sm">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex items-center justify-between h-16">
                <div class="flex items-center">
                    <span class="font-bold text-xl text-[#333333]">Amret D&I Insights</span>
                </div>
                <nav class="hidden md:flex items-center space-x-8">
                    <a href="#dashboard" class="nav-link px-1 pt-1 pb-2 text-sm font-medium">Dashboard</a>
                    <a href="#knowledge-gap" class="nav-link px-1 pt-1 pb-2 text-sm font-medium">Knowledge Gap</a>
                    <a href="#perceptions" class="nav-link px-1 pt-1 pb-2 text-sm font-medium">Perceptions</a>
                    <a href="#demographics" class="nav-link px-1 pt-1 pb-2 text-sm font-medium">Demographics</a>
                    <a href="#recommendations" class="nav-link px-1 pt-1 pb-2 text-sm font-medium">Recommendations</a>
                </nav>
            </div>
        </div>
    </header>

    <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8 md:py-12">
        
        <!-- Section 1: Dashboard -->
        <section id="dashboard" class="mb-16">
            <h1 class="text-3xl md:text-4xl font-bold text-[#333333] mb-2 text-center">Gender Equality & Unconscious Bias</h1>
            <p class="text-lg text-gray-600 mb-8 text-center max-w-3xl mx-auto">An interactive analysis of the pre-test results, establishing a baseline for Amret's Diversity & Inclusion initiatives.</p>

            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-12">
                <div class="kpi-card text-center">
                    <h3 class="text-base font-medium text-gray-500 mb-2">Average Pre-Test Score</h3>
                    <p class="text-4xl font-bold text-[#4A908A]">7.86 <span class="text-2xl font-medium text-gray-400">/ 12</span></p>
                    <p class="text-sm text-gray-500 mt-2">Indicates a mixed level of understanding.</p>
                </div>
                <div class="kpi-card text-center bg-[#D98C64]/10 border-[#D98C64]/50">
                    <h3 class="text-base font-medium text-gray-500 mb-2">Key Finding</h3>
                    <p class="text-2xl font-bold text-[#D98C64]">The Confidence-Competence Gap</p>
                    <p class="text-sm text-gray-500 mt-2">High confidence in addressing bias contrasts with low scores in practical application.</p>
                </div>
                <div class="kpi-card text-center">
                    <h3 class="text-base font-medium text-gray-500 mb-2">Organizational Buy-In</h3>
                    <p class="text-4xl font-bold text-[#4A908A]">82.1%</p>
                    <p class="text-sm text-gray-500 mt-2">Rated gender equality as "Critical" for success.</p>
                </div>
            </div>

            <div class="bg-white rounded-lg p-6 shadow-sm border border-gray-200">
                <h2 class="text-xl font-semibold mb-1">Overall Score Distribution</h2>
                <p class="text-gray-600 mb-4">This chart shows the distribution of scores among the 28 participants. While many scored in the upper-middle range, the spread highlights a diversity in knowledge levels across the organization that future training can address.</p>
                <div class="chart-container mx-auto">
                    <canvas id="scoreDistributionChart"></canvas>
                </div>
            </div>
        </section>

        <!-- Section 2: Knowledge Gap -->
        <section id="knowledge-gap" class="mb-16 pt-16">
            <h2 class="text-3xl font-bold text-center mb-2">The Knowledge Gap: Theory vs. Practice</h2>
            <p class="text-lg text-gray-600 text-center max-w-3xl mx-auto mb-10">This section explores the crucial difference between what employees know in theory and how they apply that knowledge. The data reveals strong foundational understanding but significant challenges in recognizing bias in real-world scenarios.</p>

            <div class="bg-white rounded-lg p-6 shadow-sm border border-gray-200">
                <h3 class="text-xl font-semibold mb-1">Question Performance Analysis</h3>
                <p class="text-gray-600 mb-4">Participants excelled at defining core concepts but struggled to identify specific examples of bias. The most significant gaps are in recognizing bias in recruitment, understanding specific bias types like confirmation bias, and grasping the concept of intersectionality.</p>
                <div class="chart-container h-96 md:h-[500px] max-h-[500px] max-w-4xl">
                    <canvas id="questionPerformanceChart"></canvas>
                </div>
            </div>
        </section>

        <!-- Section 3: Perceptions -->
        <section id="perceptions" class="mb-16 pt-16">
            <h2 class="text-3xl font-bold text-center mb-2">Perceptions: Confidence & Importance</h2>
            <p class="text-lg text-gray-600 text-center max-w-3xl mx-auto mb-10">Here we examine employee attitudes, revealing a strong belief in the importance of gender equality alongside a potential overconfidence in personal abilities to combat bias. This "confidence-competence gap" is a key area for development.</p>
            
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 items-start">
                <div class="bg-white rounded-lg p-6 shadow-sm border border-gray-200">
                    <h3 class="text-xl font-semibold mb-4 text-center">The Confidence-Competence Gap</h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div class="text-center">
                             <h4 class="font-semibold text-gray-700 mb-2">Self-Reported Confidence</h4>
                             <div class="chart-container h-48 max-h-48 mx-auto">
                                <canvas id="confidenceIdentifyChart"></canvas>
                            </div>
                            <div class="chart-container h-48 max-h-48 mx-auto mt-4">
                                <canvas id="confidenceAddressChart"></canvas>
                            </div>
                        </div>
                        <div class="text-center bg-red-50 rounded-lg p-4 border border-red-200">
                            <h4 class="font-semibold text-gray-700 mb-2">Practical Knowledge Score</h4>
                            <div class="mt-8">
                                <p class="text-5xl font-bold text-red-500">28.6%</p>
                                <p class="text-sm text-gray-600 mt-1">Correctly identified all bias examples in a recruitment scenario.</p>
                            </div>
                             <div class="mt-8">
                                <p class="text-5xl font-bold text-red-500">32.1%</p>
                                <p class="text-sm text-gray-600 mt-1">Correctly identified a specific bias type (confirmation bias).</p>
                            </div>
                        </div>
                    </div>
                    <p class="mt-6 text-gray-600 text-sm">The stark contrast between high confidence and low practical scores suggests employees may not recognize bias in action, hindering proactive intervention. Training must bridge this gap.</p>
                </div>

                <div class="bg-white rounded-lg p-6 shadow-sm border border-gray-200">
                     <h3 class="text-xl font-semibold mb-4 text-center">Perceived Importance of Gender Equality</h3>
                     <div class="chart-container h-64 max-h-64 mx-auto">
                        <canvas id="importanceChart"></canvas>
                    </div>
                    <div id="qualitative-card" class="mt-6">
                         <button id="reveal-quotes-btn" class="w-full bg-[#4A908A] text-white font-semibold py-2 px-4 rounded-lg hover:bg-[#3e7a74] transition-colors">Why is it important? Click to see reasons</button>
                         <div id="quotes-container" class="hidden mt-4 space-y-3 bg-gray-50 p-4 rounded-md border">
                            <p class="text-sm text-gray-700"><strong>Creative Solutions:</strong> "It often produces more creative solutions and better decision-making."</p>
                            <p class="text-sm text-gray-700"><strong>Talent Utilization:</strong> "It maximizes human potential and talent utilization across society."</p>
                            <p class="text-sm text-gray-700"><strong>Systemic Barriers:</strong> An awareness that women's "additional responsibilities...sometimes stop them from growing" despite equal opportunities.</p>
                         </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Section 4: Demographics -->
        <section id="demographics" class="mb-16 pt-16">
            <h2 class="text-3xl font-bold text-center mb-2">Demographic Deep Dive</h2>
            <p class="text-lg text-gray-600 text-center max-w-3xl mx-auto mb-10">This interactive chart lets you explore the data by department and gender. Please note: due to the small sample size (especially for gender), these views are for exploratory purposes and not for drawing statistically significant conclusions.</p>
            
            <div class="bg-white rounded-lg p-6 shadow-sm border border-gray-200">
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
                    <div>
                        <label for="departmentFilter" class="block text-sm font-medium text-gray-700">Department</label>
                        <select id="departmentFilter" class="mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-[#4A908A] focus:border-[#4A908A] sm:text-sm rounded-md">
                            <option>All Departments</option>
                        </select>
                    </div>
                    <div class="md:col-span-2">
                        <label class="block text-sm font-medium text-gray-700">Gender</label>
                        <fieldset class="mt-2">
                            <div class="flex items-center space-x-4">
                                <label class="flex items-center">
                                    <input type="radio" name="genderFilter" value="All" class="h-4 w-4 text-[#4A908A] border-gray-300 focus:ring-[#4A908A]" checked>
                                    <span class="ml-2 text-sm text-gray-700">All</span>
                                </label>
                                <label class="flex items-center">
                                    <input type="radio" name="genderFilter" value="Male" class="h-4 w-4 text-[#4A908A] border-gray-300 focus:ring-[#4A908A]">
                                    <span class="ml-2 text-sm text-gray-700">Male</span>
                                </label>
                                <label class="flex items-center">
                                    <input type="radio" name="genderFilter" value="Female" class="h-4 w-4 text-[#4A908A] border-gray-300 focus:ring-[#4A908A]">
                                    <span class="ml-2 text-sm text-gray-700">Female</span>
                                </label>
                            </div>
                        </fieldset>
                    </div>
                </div>
                 <div class="chart-container h-96 max-h-96 max-w-4xl">
                    <canvas id="demographicsChart"></canvas>
                </div>
                <p id="demographics-summary" class="text-center text-sm text-gray-500 mt-4">Displaying data for all 28 participants.</p>
            </div>
        </section>

        <!-- Section 5: Recommendations -->
        <section id="recommendations" class="pt-16">
            <h2 class="text-3xl font-bold text-center mb-2">Strategic Recommendations</h2>
            <p class="text-lg text-gray-600 text-center max-w-3xl mx-auto mb-10">Based on the pre-test analysis, the following actions are recommended to advance Amret's D&I goals. The focus is on bridging the knowledge gap, calibrating confidence, and addressing systemic cultural factors.</p>

            <div id="accordion-container" class="space-y-4 max-w-4xl mx-auto">
                <!-- Accordion items will be injected by JS -->
            </div>
        </section>
    </main>

    <footer class="bg-gray-100 mt-16">
        <div class="max-w-7xl mx-auto py-6 px-4 sm:px-6 lg:px-8 text-center text-gray-500 text-sm">
            <p>Amret MFI | Diversity & Inclusion Pre-Test Analysis | June 2025</p>
        </div>
    </footer>

    <script>
        document.addEventListener('DOMContentLoaded', () => {

            const preTestData = [
                { id: 1, department: "ITD", gender: "Male", score: 8, conf_id: 5, conf_add: 5, importance: "Critical" },
                { id: 2, department: "L&DD", gender: "Male", score: 9, conf_id: 4, conf_add: 5, importance: "Critical" },
                { id: 3, department: "Commercial Digital & Analytics", gender: "Male", score: 9, conf_id: 4, conf_add: 5, importance: "Critical" },
                { id: 4, department: "Digital Transformation", gender: "Male", score: 9, conf_id: 3, conf_add: 3, importance: "Critical" },
                { id: 5, department: "Digital Channels and Platforms", gender: "Male", score: 7, conf_id: 4, conf_add: 4, importance: "Critical" },
                { id: 6, department: "Learning and Development", gender: "Female", score: 6, conf_id: 3, conf_add: 3, importance: "Critical" },
                { id: 7, department: "L&D", gender: "Female", score: 7, conf_id: 3, conf_add: 3, importance: "Critical" },
                { id: 8, department: "IT Audit", gender: "Male", score: 5, conf_id: 4, conf_add: 4, importance: "Important" },
                { id: 9, department: "Risk Division", gender: "Male", score: 8, conf_id: 4, conf_add: 4, importance: "Critical" },
                { id: 10, department: "Compliance", gender: "Female", score: 11, conf_id: 5, conf_add: 4, importance: "Critical" },
                { id: 11, department: "IT", gender: "Male", score: 12, conf_id: 4, conf_add: 4, importance: "Critical" },
                { id: 12, department: "HR", gender: "Female", score: 10, conf_id: 3, conf_add: 3, importance: "Critical" },
                { id: 13, department: "Commercial Product", gender: "Male", score: 8, conf_id: 4, conf_add: 4, importance: "Important" },
                { id: 14, department: "Customer Resolution & Service Quality", gender: "Male", score: 7, conf_id: 3, conf_add: 3, importance: "Important" },
                { id: 15, department: "Marketing", gender: "Female", score: 8, conf_id: 5, conf_add: 5, importance: "Critical" },
                { id: 16, department: "Sale division", gender: "Male", score: 8, conf_id: 5, conf_add: 4, importance: "Critical" },
                { id: 17, department: "L&D", gender: "Male", score: 7, conf_id: 4, conf_add: 4, importance: "Critical" },
                { id: 18, department: "Audit", gender: "Male", score: 10, conf_id: 5, conf_add: 4, importance: "Critical" },
                { id: 19, department: "Sales", gender: "Male", score: 6, conf_id: 4, conf_add: 3, importance: "Critical" },
                { id: 20, department: "Operational Risk Department", gender: "Male", score: 7, conf_id: 4, conf_add: 4, importance: "Critical" },
                { id: 21, department: "Sale", gender: "Male", score: 5, conf_id: 5, conf_add: 5, importance: "Critical" },
                { id: 22, department: "Sale Divission", gender: "Male", score: 7, conf_id: 4, conf_add: 4, importance: "Critical" },
                { id: 23, department: "HRBP", gender: "Female", score: 11, conf_id: 5, conf_add: 5, importance: "Critical" },
                { id: 24, department: "Digital and IT", gender: "Male", score: 10, conf_id: 5, conf_add: 5, importance: "Important" },
                { id: 25, department: "Loan Recovery", gender: "Male", score: 9, conf_id: 5, conf_add: 5, importance: "Critical" },
                { id: 26, department: "Loan Underwriting", gender: "Male", score: 7, conf_id: 4, conf_add: 4, importance: "Critical" },
                { id: 27, department: "Administration", gender: "Male", score: 12, conf_id: 5, conf_add: 5, importance: "Critical" },
                { id: 28, department: "Credit Policy and Control", gender: "Male", score: 6, conf_id: 5, conf_add: 5, importance: "Critical" }
            ];
            
            const questionPerformanceData = {
                'Gender Equality Definition': 100,
                'Unconscious Bias Definition': 100,
                'Sex vs. Gender': 85.7,
                'Diversity Benefits': 85.7,
                'Inclusive Workplace': 89.3,
                'Gender Equality & Development': 92.8,
                'Intersectionality': 53.6,
                'Unconscious Bias Examples': 28.6,
                'Types of Unconscious Bias': 32.1,
            };

            const recommendationsData = [
                {
                    title: "Targeted Training & Awareness",
                    content: "Shift training from basic definitions to practical application. Use scenario-based case studies for recruitment and performance management. Create dedicated workshops on specific biases (confirmation, affinity) and complex concepts like intersectionality to build deeper, applicable skills."
                },
                {
                    title: "Calibrate Confidence with Competence",
                    content: "Incorporate objective skill assessments into training, such as pre/post-module quizzes and peer feedback sessions. This encourages a mindset of continuous learning and helps align employees' self-perception of their abilities with their actual competence."
                },
                {
                    title: "Foster an Inclusive Culture",
                    content: "Address systemic barriers revealed in qualitative feedback, such as work-life integration challenges. Empower leadership to model inclusive behaviors and hold teams accountable. Foster ongoing dialogue through forums and employee resource groups to move beyond one-off training events."
                },
            ];

            const renderScoreDistributionChart = () => {
                const ctx = document.getElementById('scoreDistributionChart').getContext('2d');
                const scoreCounts = preTestData.reduce((acc, item) => {
                    acc[item.score] = (acc[item.score] || 0) + 1;
                    return acc;
                }, {});

                new Chart(ctx, {
                    type: 'bar',
                    data: {
                        labels: Object.keys(scoreCounts).sort((a,b) => a-b),
                        datasets: [{
                            label: '# of Participants',
                            data: Object.values(scoreCounts),
                            backgroundColor: 'rgba(74, 144, 138, 0.6)',
                            borderColor: 'rgba(74, 144, 138, 1)',
                            borderWidth: 1
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        scales: {
                            y: {
                                beginAtZero: true,
                                title: { display: true, text: 'Number of Participants' }
                            },
                            x: {
                                title: { display: true, text: 'Score out of 12' }
                            }
                        },
                        plugins: {
                            legend: { display: false }
                        }
                    }
                });
            };

            const renderQuestionPerformanceChart = () => {
                const ctx = document.getElementById('questionPerformanceChart').getContext('2d');
                const sortedData = Object.entries(questionPerformanceData).sort(([,a],[,b]) => a-b);
                
                new Chart(ctx, {
                    type: 'bar',
                    data: {
                        labels: sortedData.map(d => d[0].length > 25 ? d[0].substring(0, 25) + '...' : d[0]),
                        datasets: [{
                            label: '% Correct',
                            data: sortedData.map(d => d[1]),
                            backgroundColor: sortedData.map(d => d[1] > 75 ? 'rgba(74, 144, 138, 0.6)' : 'rgba(217, 140, 100, 0.6)'),
                            borderColor: sortedData.map(d => d[1] > 75 ? 'rgba(74, 144, 138, 1)' : 'rgba(217, 140, 100, 1)'),
                            borderWidth: 1
                        }]
                    },
                    options: {
                        indexAxis: 'y',
                        responsive: true,
                        maintainAspectRatio: false,
                        scales: {
                            x: {
                                beginAtZero: true,
                                max: 100,
                                title: { display: true, text: 'Correct Response Rate (%)' }
                            }
                        },
                        plugins: {
                            legend: { display: false },
                            tooltip: {
                                callbacks: {
                                    label: function(context) {
                                        return `${context.dataset.label}: ${context.raw}%`;
                                    },
                                    title: function(context) {
                                        return sortedData[context[0].dataIndex][0];
                                    }
                                }
                            }
                        }
                    }
                });
            };

            const createDoughnutChart = (canvasId, data, label, color) => {
                const ctx = document.getElementById(canvasId).getContext('2d');
                new Chart(ctx, {
                    type: 'doughnut',
                    data: {
                        labels: [label, ''],
                        datasets: [{
                            data: data,
                            backgroundColor: [color, '#E5E7EB'],
                            borderColor: ['#FFFFFF'],
                            borderWidth: 2
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        cutout: '70%',
                        plugins: {
                            legend: { display: false },
                            tooltip: { enabled: false },
                            title: {
                                display: true,
                                text: `${data[0]} / 5`,
                                position: 'bottom',
                                font: { size: 14, weight: 'bold' },
                                color: '#333333',
                                padding: { top: -40 }
                            },
                             subtitle: {
                                display: true,
                                text: label,
                                position: 'top',
                                font: { size: 12 },
                                color: '#6B7280',
                                padding: { top: 30 }
                            }
                        }
                    }
                });
            };
            
            const renderConfidenceCharts = () => {
                const avgConfId = (preTestData.reduce((sum, item) => sum + item.conf_id, 0) / preTestData.length).toFixed(1);
                const avgConfAdd = (preTestData.reduce((sum, item) => sum + item.conf_add, 0) / preTestData.length).toFixed(1);

                createDoughnutChart('confidenceIdentifyChart', [avgConfId, 5 - avgConfId], 'Identifying Bias', '#4A908A');
                createDoughnutChart('confidenceAddressChart', [avgConfAdd, 5 - avgConfAdd], 'Addressing Bias', '#4A908A');
            };

            const renderImportanceChart = () => {
                 const ctx = document.getElementById('importanceChart').getContext('2d');
                 const importanceCounts = preTestData.reduce((acc, item) => {
                    acc[item.importance] = (acc[item.importance] || 0) + 1;
                    return acc;
                }, {});
                const criticalPercent = (importanceCounts['Critical'] / preTestData.length * 100).toFixed(1);

                new Chart(ctx, {
                    type: 'doughnut',
                    data: {
                        labels: ['Critical', 'Important'],
                        datasets: [{
                            data: [importanceCounts['Critical'], importanceCounts['Important']],
                            backgroundColor: ['#4A908A', '#D98C64'],
                            borderColor: '#FFFFFF',
                            borderWidth: 2
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        cutout: '60%',
                        plugins: {
                            legend: { position: 'bottom' },
                            title: {
                                display: true,
                                text: `${criticalPercent}% Rated as Critical`,
                                font: { size: 16, weight: 'bold' },
                                padding: { top: 10, bottom: 10 }
                            }
                        }
                    }
                });

                document.getElementById('reveal-quotes-btn').addEventListener('click', function() {
                    document.getElementById('quotes-container').classList.toggle('hidden');
                    this.textContent = document.getElementById('quotes-container').classList.contains('hidden') ? 
                        'Why is it important? Click to see reasons' : 'Hide reasons';
                });
            };

            let demographicsChart;
            const renderDemographicsChart = (filteredData) => {
                const ctx = document.getElementById('demographicsChart').getContext('2d');
                const chartData = {
                    datasets: [{
                        label: 'Male',
                        data: filteredData.filter(d => d.gender === 'Male').map(d => ({x: d.conf_id, y: d.score, r: d.conf_add * 3})),
                        backgroundColor: 'rgba(74, 144, 138, 0.6)'
                    }, {
                        label: 'Female',
                        data: filteredData.filter(d => d.gender === 'Female').map(d => ({x: d.conf_id, y: d.score, r: d.conf_add * 3})),
                        backgroundColor: 'rgba(217, 140, 100, 0.7)'
                    }]
                };

                if (demographicsChart) {
                    demographicsChart.data = chartData;
                    demographicsChart.update();
                } else {
                    demographicsChart = new Chart(ctx, {
                        type: 'bubble',
                        data: chartData,
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            scales: {
                                y: {
                                    title: { display: true, text: 'Pre-Test Score' },
                                    min: 0,
                                    max: 12
                                },
                                x: {
                                    title: { display: true, text: 'Confidence in Identifying Bias (1-5)' },
                                    min: 1,
                                    max: 5
                                }
                            },
                            plugins: {
                                legend: { position: 'top' },
                                tooltip: {
                                    callbacks: {
                                        label: function(context) {
                                            const d = context.raw;
                                            return `${context.dataset.label}: Score ${d.y}, Conf. Identify ${d.x}, Conf. Address ${d.r/3}`;
                                        }
                                    }
                                }
                            }
                        }
                    });
                }
            };
            
            const setupDemographicsFilter = () => {
                const departments = [...new Set(preTestData.map(d => d.department))].sort();
                const departmentFilter = document.getElementById('departmentFilter');
                departments.forEach(dept => {
                    const option = document.createElement('option');
                    option.value = dept;
                    option.textContent = dept;
                    departmentFilter.appendChild(option);
                });

                const updateFilters = () => {
                    const selectedDept = departmentFilter.value;
                    const selectedGender = document.querySelector('input[name="genderFilter"]:checked').value;
                    
                    let filteredData = preTestData;

                    if (selectedDept !== 'All Departments') {
                        filteredData = filteredData.filter(d => d.department === selectedDept);
                    }
                    if (selectedGender !== 'All') {
                        filteredData = filteredData.filter(d => d.gender === selectedGender);
                    }

                    renderDemographicsChart(filteredData);

                    let summaryText = `Displaying data for ${filteredData.length} participant(s)`;
                    if(selectedDept !== 'All Departments') summaryText += ` in ${selectedDept}`;
                    if(selectedGender !== 'All') summaryText += ` (${selectedGender})`;
                    summaryText += '.';
                    document.getElementById('demographics-summary').textContent = summaryText;
                };

                departmentFilter.addEventListener('change', updateFilters);
                document.querySelectorAll('input[name="genderFilter"]').forEach(radio => {
                    radio.addEventListener('change', updateFilters);
                });
                
                renderDemographicsChart(preTestData);
            };
            
            const renderRecommendationsAccordion = () => {
                const container = document.getElementById('accordion-container');
                recommendationsData.forEach((item, index) => {
                    const accordionItem = document.createElement('div');
                    accordionItem.className = 'bg-white rounded-lg shadow-sm border border-gray-200';
                    accordionItem.innerHTML = `
                        <h2>
                            <button type="button" class="flex items-center justify-between w-full p-5 font-medium text-left text-gray-700 hover:bg-gray-100" data-accordion-target="#accordion-body-${index}">
                                <span>${item.title}</span>
                                <svg data-accordion-icon class="w-6 h-6 shrink-0" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd"></path></svg>
                            </button>
                        </h2>
                        <div id="accordion-body-${index}" class="hidden p-5 border-t border-gray-200">
                            <p class="text-gray-600">${item.content}</p>
                        </div>
                    `;
                    container.appendChild(accordionItem);
                });

                container.addEventListener('click', (e) => {
                    const button = e.target.closest('button[data-accordion-target]');
                    if (button) {
                        const targetId = button.getAttribute('data-accordion-target');
                        const body = document.querySelector(targetId);
                        const icon = button.querySelector('svg[data-accordion-icon]');
                        
                        body.classList.toggle('hidden');
                        icon.classList.toggle('rotate-180');
                    }
                });
            };

            const setupNavObserver = () => {
                const sections = document.querySelectorAll('section[id]');
                const navLinks = document.querySelectorAll('.nav-link');

                const observer = new IntersectionObserver((entries) => {
                    entries.forEach(entry => {
                        if (entry.isIntersecting) {
                            navLinks.forEach(link => {
                                link.classList.toggle('active', link.getAttribute('href').substring(1) === entry.target.id);
                            });
                        }
                    });
                }, { rootMargin: '-20% 0px -80% 0px', threshold: 0 });

                sections.forEach(section => observer.observe(section));
            };

            renderScoreDistributionChart();
            renderQuestionPerformanceChart();
            renderConfidenceCharts();
            renderImportanceChart();
            setupDemographicsFilter();
            renderRecommendationsAccordion();
            setupNavObserver();
        });
    </script>
</body>
</html>
